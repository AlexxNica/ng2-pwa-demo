{"version":3,"file":"animation.js","sourceRoot":"","sources":["../../../../../../modules/@angular/platform-browser/src/animate/animation.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  DateWrapper,\n  StringWrapper,\n  RegExpWrapper,\n  NumberWrapper,\n  isPresent\n} from '../../src/facade/lang';\nimport {Math} from '../../src/facade/math';\nimport {StringMapWrapper} from '../../src/facade/collection';\nimport {camelCaseToDashCase} from '../dom/util';\nimport {getDOM} from '../dom/dom_adapter';\n\nimport {BrowserDetails} from './browser_details';\nimport {CssAnimationOptions} from './css_animation_options';\n\nexport class Animation {\n  /** functions to be called upon completion */\n  callbacks: Function[] = [];\n\n  /** the duration (ms) of the animation (whether from CSS or manually set) */\n  computedDuration: number;\n\n  /** the animation delay (ms) (whether from CSS or manually set) */\n  computedDelay: number;\n\n  /** timestamp of when the animation started */\n  startTime: number;\n\n  /** functions for removing event listeners */\n  eventClearFunctions: Function[] = [];\n\n  /** flag used to track whether or not the animation has finished */\n  completed: boolean = false;\nprivate _stringPrefix: string = '';\n\n  /** total amount of time that the animation should take including delay */\n  get totalTime(): number {\n    let /** @type {?} */ delay = this.computedDelay != null ? this.computedDelay : 0;\n    let /** @type {?} */ duration = this.computedDuration != null ? this.computedDuration : 0;\n    return delay + duration;\n  }\n/**\n *  Stores the start time and starts the animation\n * @param {?} element\n * @param {?} data\n * @param {?} browserDetails\n */\nconstructor(public element: HTMLElement,\npublic data: CssAnimationOptions,\npublic browserDetails: BrowserDetails) {\n    this.startTime = DateWrapper.toMillis(DateWrapper.now());\n    this._stringPrefix = getDOM().getAnimationPrefix();\n    this.setup();\n    this.wait((timestamp: any) => this.start());\n  }\n/**\n * @param {?} callback\n * @return {?}\n */\nwait(callback: Function) {\n    // Firefox requires 2 frames for some reason\n    this.browserDetails.raf(callback, 2);\n  }\n/**\n *  Sets up the initial styles before the animation is started\n * @return {?}\n */\nsetup(): void {\n    if (this.data.fromStyles != null) this.applyStyles(this.data.fromStyles);\n    if (this.data.duration != null)\n      this.applyStyles({'transitionDuration': this.data.duration.toString() + 'ms'});\n    if (this.data.delay != null)\n      this.applyStyles({'transitionDelay': this.data.delay.toString() + 'ms'});\n  }\n/**\n *  After the initial setup has occurred, this method adds the animation styles\n * @return {?}\n */\nstart(): void {\n    this.addClasses(this.data.classesToAdd);\n    this.addClasses(this.data.animationClasses);\n    this.removeClasses(this.data.classesToRemove);\n    if (this.data.toStyles != null) this.applyStyles(this.data.toStyles);\n    var /** @type {?} */ computedStyles = getDOM().getComputedStyle(this.element);\n    this.computedDelay =\n        Math.max(this.parseDurationString(\n                     computedStyles.getPropertyValue(this._stringPrefix + 'transition-delay')),\n                 this.parseDurationString(\n                     this.element.style.getPropertyValue(this._stringPrefix + 'transition-delay')));\n    this.computedDuration = Math.max(this.parseDurationString(computedStyles.getPropertyValue(\n                                         this._stringPrefix + 'transition-duration')),\n                                     this.parseDurationString(this.element.style.getPropertyValue(\n                                         this._stringPrefix + 'transition-duration')));\n    this.addEvents();\n  }\n/**\n *  Applies the provided styles to the element\n * @param {?} styles\n * @return {?}\n */\napplyStyles(styles: {[key: string]: any}): void {\n    StringMapWrapper.forEach(styles, (value: any, key: string) => {\n      var /** @type {?} */ dashCaseKey = camelCaseToDashCase(key);\n      if (isPresent(getDOM().getStyle(this.element, dashCaseKey))) {\n        getDOM().setStyle(this.element, dashCaseKey, value.toString());\n      } else {\n        getDOM().setStyle(this.element, this._stringPrefix + dashCaseKey, value.toString());\n      }\n    });\n  }\n/**\n *  Adds the provided classes to the element\n * @param {?} classes\n * @return {?}\n */\naddClasses(classes: string[]): void {\n    for (let /** @type {?} */ i = 0, /** @type {?} */ len = classes.length; i < len; i++) getDOM().addClass(this.element, classes[i]);\n  }\n/**\n *  Removes the provided classes from the element\n * @param {?} classes\n * @return {?}\n */\nremoveClasses(classes: string[]): void {\n    for (let /** @type {?} */ i = 0, /** @type {?} */ len = classes.length; i < len; i++)\n      getDOM().removeClass(this.element, classes[i]);\n  }\n/**\n *  Adds events to track when animations have finished\n * @return {?}\n */\naddEvents(): void {\n    if (this.totalTime > 0) {\n      this.eventClearFunctions.push(\n          getDOM().onAndCancel(this.element, getDOM().getTransitionEnd(),\n                               (event: any) => this.handleAnimationEvent(event)));\n    } else {\n      this.handleAnimationCompleted();\n    }\n  }\n/**\n * @param {?} event\n * @return {?}\n */\nhandleAnimationEvent(event: any): void {\n    let /** @type {?} */ elapsedTime = Math.round(event.elapsedTime * 1000);\n    if (!this.browserDetails.elapsedTimeIncludesDelay) elapsedTime += this.computedDelay;\n    event.stopPropagation();\n    if (elapsedTime >= this.totalTime) this.handleAnimationCompleted();\n  }\n/**\n *  Runs all animation callbacks and removes temporary classes\n * @return {?}\n */\nhandleAnimationCompleted(): void {\n    this.removeClasses(this.data.animationClasses);\n    this.callbacks.forEach(callback => callback());\n    this.callbacks = [];\n    this.eventClearFunctions.forEach(fn => fn());\n    this.eventClearFunctions = [];\n    this.completed = true;\n  }\n/**\n *  Adds animation callbacks to be called upon completion\n * @returns {Animation}\n * @param {?} callback\n * @return {?}\n */\nonComplete(callback: Function): Animation {\n    if (this.completed) {\n      callback();\n    } else {\n      this.callbacks.push(callback);\n    }\n    return this;\n  }\n/**\n *  Converts the duration string to the number of milliseconds\n * @returns {number}\n * @param {?} duration\n * @return {?}\n */\nparseDurationString(duration: string): number {\n    var /** @type {?} */ maxValue = 0;\n    // duration must have at least 2 characters to be valid. (number + type)\n    if (duration == null || duration.length < 2) {\n      return maxValue;\n    } else if (duration.substring(duration.length - 2) == 'ms') {\n      let /** @type {?} */ value = NumberWrapper.parseInt(this.stripLetters(duration), 10);\n      if (value > maxValue) maxValue = value;\n    } else if (duration.substring(duration.length - 1) == 's') {\n      let /** @type {?} */ ms = NumberWrapper.parseFloat(this.stripLetters(duration)) * 1000;\n      let /** @type {?} */ value = Math.floor(ms);\n      if (value > maxValue) maxValue = value;\n    }\n    return maxValue;\n  }\n/**\n *  Strips the letters from the duration string\n * @returns {string}\n * @param {?} str\n * @return {?}\n */\nstripLetters(str: string): string {\n    return StringWrapper.replaceAll(str, RegExpWrapper.create('[^0-9]+$', ''), '');\n  }\n\n  static _tsickle_typeAnnotationsHelper() {\n /** functions to be called upon completion\n @type {?} */\nAnimation.prototype.callbacks;\n /** the duration (ms) of the animation (whether from CSS or manually set)\n @type {?} */\nAnimation.prototype.computedDuration;\n /** the animation delay (ms) (whether from CSS or manually set)\n @type {?} */\nAnimation.prototype.computedDelay;\n /** timestamp of when the animation started\n @type {?} */\nAnimation.prototype.startTime;\n /** functions for removing event listeners\n @type {?} */\nAnimation.prototype.eventClearFunctions;\n /** flag used to track whether or not the animation has finished\n @type {?} */\nAnimation.prototype.completed;\n /** @type {?} */\nAnimation.prototype._stringPrefix;\n /** @type {?} */\nAnimation.prototype.element;\n /** @type {?} */\nAnimation.prototype.data;\n /** @type {?} */\nAnimation.prototype.browserDetails;\n  }\n\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}