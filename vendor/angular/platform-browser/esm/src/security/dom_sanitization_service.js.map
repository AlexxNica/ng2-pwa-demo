{"version":3,"file":"dom_sanitization_service.js","sourceRoot":"","sources":["../../../../../../modules/@angular/platform-browser/src/security/dom_sanitization_service.ts"],"names":[],"mappings":"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","sourcesContent":["import {Injectable} from '@angular/core';\n\nimport {SecurityContext, SanitizationService} from '../../core_private';\n\nimport {sanitizeHtml} from './html_sanitizer';\nimport {sanitizeUrl} from './url_sanitizer';\nimport {sanitizeStyle} from './style_sanitizer';\n\nexport {SecurityContext};\n\n/** Marker interface for a value that's safe to use in a particular context. */\nexport interface SafeValue {}\n/** Marker interface for a value that's safe to use as HTML. */\nexport interface SafeHtml extends SafeValue {}\n/** Marker interface for a value that's safe to use as style (CSS). */\nexport interface SafeStyle extends SafeValue {}\n/** Marker interface for a value that's safe to use as JavaScript. */\nexport interface SafeScript extends SafeValue {}\n/** Marker interface for a value that's safe to use as a URL linking to a document. */\nexport interface SafeUrl extends SafeValue {}\n/** Marker interface for a value that's safe to use as a URL to load executable code from. */\nexport interface SafeResourceUrl extends SafeValue {}\n\n/**\n * DomSanitizationService helps preventing Cross Site Scripting Security bugs (XSS) by sanitizing\n * values to be safe to use in the different DOM contexts.\n *\n * For example, when binding a URL in an `<a [href]=\"someValue\">` hyperlink, `someValue` will be\n * sanitized so that an attacker cannot inject e.g. a `javascript:` URL that would execute code on\n * the website.\n *\n * In specific situations, it might be necessary to disable sanitization, for example if the\n * application genuinely needs to produce a `javascript:` style link with a dynamic value in it.\n * Users can bypass security by constructing a value with one of the `bypassSecurityTrust...`\n * methods, and then binding to that value from the template.\n *\n * These situations should be very rare, and extraordinary care must be taken to avoid creating a\n * Cross Site Scripting (XSS) security bug!\n *\n * When using `bypassSecurityTrust...`, make sure to call the method as early as possible and as\n * close as possible to the source of the value, to make it easy to verify no security bug is\n * created by its use.\n *\n * It is not required (and not recommended) to bypass security if the value is safe, e.g. a URL that\n * does not start with a suspicious protocol, or an HTML snippet that does not contain dangerous\n * code. The sanitizer leaves safe values intact.\n */\nexport abstract class DomSanitizationService implements SanitizationService {\n  /**\n   * Sanitizes a value for use in the given SecurityContext.\n   *\n   * If value is trusted for the context, this method will unwrap the contained safe value and use\n   * it directly. Otherwise, value will be sanitized to be safe in the given context, for example\n   * by replacing URLs that have an unsafe protocol part (such as `javascript:`). The implementation\n   * is responsible to make sure that the value can definitely be safely used in the given context.\n   */\n  abstract sanitize(context: SecurityContext, value: any): string;\n\n  /**\n   * Bypass security and trust the given value to be safe HTML. Only use this when the bound HTML\n   * is unsafe (e.g. contains `<script>` tags) and the code should be executed. The sanitizer will\n   * leave safe HTML intact, so in most situations this method should not be used.\n   *\n   * WARNING: calling this method with untrusted user data will cause severe security bugs!\n   */\n  abstract bypassSecurityTrustHtml(value: string): SafeHtml;\n\n  /**\n   * Bypass security and trust the given value to be safe style value (CSS).\n   *\n   * WARNING: calling this method with untrusted user data will cause severe security bugs!\n   */\n  abstract bypassSecurityTrustStyle(value: string): SafeStyle;\n\n  /**\n   * Bypass security and trust the given value to be safe JavaScript.\n   *\n   * WARNING: calling this method with untrusted user data will cause severe security bugs!\n   */\n  abstract bypassSecurityTrustScript(value: string): SafeScript;\n\n  /**\n   * Bypass security and trust the given value to be a safe style URL, i.e. a value that can be used\n   * in hyperlinks or `<iframe src>`.\n   *\n   * WARNING: calling this method with untrusted user data will cause severe security bugs!\n   */\n  abstract bypassSecurityTrustUrl(value: string): SafeUrl;\n\n  /**\n   * Bypass security and trust the given value to be a safe resource URL, i.e. a location that may\n   * be used to load executable code from, like `<script src>`.\n   *\n   * WARNING: calling this method with untrusted user data will cause severe security bugs!\n   */\n  abstract bypassSecurityTrustResourceUrl(value: string);\n}\nexport class DomSanitizationServiceImpl extends DomSanitizationService {\n/**\n * @param {?} ctx\n * @param {?} value\n * @return {?}\n */\nsanitize(ctx: SecurityContext, value: any): string {\n    if (value == null) return null;\n    switch (ctx) {\n      case SecurityContext.NONE:\n        return value;\n      case SecurityContext.HTML:\n        if (value instanceof SafeHtmlImpl) return value.changingThisBreaksApplicationSecurity;\n        this.checkNotSafeValue(value, 'HTML');\n        return sanitizeHtml(String(value));\n      case SecurityContext.STYLE:\n        if (value instanceof SafeStyleImpl) return value.changingThisBreaksApplicationSecurity;\n        this.checkNotSafeValue(value, 'Style');\n        return sanitizeStyle(value);\n      case SecurityContext.SCRIPT:\n        if (value instanceof SafeScriptImpl) return value.changingThisBreaksApplicationSecurity;\n        this.checkNotSafeValue(value, 'Script');\n        throw new Error('unsafe value used in a script context');\n      case SecurityContext.URL:\n        if (value instanceof SafeUrlImpl) return value.changingThisBreaksApplicationSecurity;\n        this.checkNotSafeValue(value, 'URL');\n        return sanitizeUrl(String(value));\n      case SecurityContext.RESOURCE_URL:\n        if (value instanceof SafeResourceUrlImpl) {\n          return value.changingThisBreaksApplicationSecurity;\n        }\n        this.checkNotSafeValue(value, 'ResourceURL');\n        throw new Error('unsafe value used in a resource URL context');\n      default:\n        throw new Error(`Unexpected SecurityContext ${ctx}`);\n    }\n  }\n/**\n * @param {?} value\n * @param {?} expectedType\n * @return {?}\n */\nprivate checkNotSafeValue(value: any, expectedType: string) {\n    if (value instanceof SafeValueImpl) {\n      throw new Error('Required a safe ' + expectedType + ', got a ' + value.getTypeName());\n    }\n  }\n/**\n * @param {?} value\n * @return {?}\n */\nbypassSecurityTrustHtml(value: string): SafeHtml { return new SafeHtmlImpl(value); }\n/**\n * @param {?} value\n * @return {?}\n */\nbypassSecurityTrustStyle(value: string): SafeStyle { return new SafeStyleImpl(value); }\n/**\n * @param {?} value\n * @return {?}\n */\nbypassSecurityTrustScript(value: string): SafeScript { return new SafeScriptImpl(value); }\n/**\n * @param {?} value\n * @return {?}\n */\nbypassSecurityTrustUrl(value: string): SafeUrl { return new SafeUrlImpl(value); }\n/**\n * @param {?} value\n * @return {?}\n */\nbypassSecurityTrustResourceUrl(value: string): SafeResourceUrl {\n    return new SafeResourceUrlImpl(value);\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n}\n\nabstract class SafeValueImpl implements SafeValue {\n/**\n * @param {?} changingThisBreaksApplicationSecurity\n */\nconstructor(public changingThisBreaksApplicationSecurity: string) {\n    // empty\n  }\n  abstract getTypeName(): string;\n\n  static _tsickle_typeAnnotationsHelper() {\n /** @type {?} */\nSafeValueImpl.prototype.changingThisBreaksApplicationSecurity;\n  }\n\n}\n\nclass SafeHtmlImpl extends SafeValueImpl implements SafeHtml {\n/**\n * @return {?}\n */\ngetTypeName() { return 'HTML'; }\n}\nclass SafeStyleImpl extends SafeValueImpl implements SafeStyle {\n/**\n * @return {?}\n */\ngetTypeName() { return 'Style'; }\n}\nclass SafeScriptImpl extends SafeValueImpl implements SafeScript {\n/**\n * @return {?}\n */\ngetTypeName() { return 'Script'; }\n}\nclass SafeUrlImpl extends SafeValueImpl implements SafeUrl {\n/**\n * @return {?}\n */\ngetTypeName() { return 'URL'; }\n}\nclass SafeResourceUrlImpl extends SafeValueImpl implements SafeResourceUrl {\n/**\n * @return {?}\n */\ngetTypeName() { return 'ResourceURL'; }\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}