{"version":3,"file":"key_events.js","sourceRoot":"","sources":["../../../../../../../modules/@angular/platform-browser/src/dom/events/key_events.ts"],"names":[],"mappings":"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","sourcesContent":["import {NgZone, Injectable} from '@angular/core';\nimport {\n  isPresent,\n  StringWrapper,\n} from '../../../src/facade/lang';\nimport {StringMapWrapper, ListWrapper} from '../../../src/facade/collection';\n\nimport {getDOM} from '../dom_adapter';\nimport {EventManagerPlugin} from './event_manager';\n\n\nvar /** @type {?} */ modifierKeys = ['alt', 'control', 'meta', 'shift'];\nvar /** @type {?} */ modifierKeyGetters: {[key: string]: (event: KeyboardEvent) => boolean} = {\n  'alt': (event: KeyboardEvent) => event.altKey,\n  'control': (event: KeyboardEvent) => event.ctrlKey,\n  'meta': (event: KeyboardEvent) => event.metaKey,\n  'shift': (event: KeyboardEvent) => event.shiftKey\n};\nexport class KeyEventsPlugin extends EventManagerPlugin {\n/**\n */\nconstructor() { super(); }\n/**\n * @param {?} eventName\n * @return {?}\n */\nsupports(eventName: string): boolean {\n    return isPresent(KeyEventsPlugin.parseEventName(eventName));\n  }\n/**\n * @param {?} element\n * @param {?} eventName\n * @param {?} handler\n * @return {?}\n */\naddEventListener(element: HTMLElement, eventName: string, handler: Function): Function {\n    var /** @type {?} */ parsedEvent = KeyEventsPlugin.parseEventName(eventName);\n\n    var /** @type {?} */ outsideHandler = KeyEventsPlugin.eventCallback(\n        element, StringMapWrapper.get(parsedEvent, 'fullKey'), handler, this.manager.getZone());\n\n    return this.manager.getZone().runOutsideAngular(() => {\n      return getDOM().onAndCancel(element, StringMapWrapper.get(parsedEvent, 'domEventName'),\n                                  outsideHandler);\n    });\n  }\n/**\n * @param {?} eventName\n * @return {?}\n */\nstatic parseEventName(eventName: string): {[key: string]: string} {\n    var /** @type {?} */ parts: string[] = eventName.toLowerCase().split('.');\n\n    var /** @type {?} */ domEventName = parts.shift();\n    if ((parts.length === 0) ||\n        !(StringWrapper.equals(domEventName, 'keydown') ||\n          StringWrapper.equals(domEventName, 'keyup'))) {\n      return null;\n    }\n\n    var /** @type {?} */ key = KeyEventsPlugin._normalizeKey(parts.pop());\n\n    var /** @type {?} */ fullKey = '';\n    modifierKeys.forEach(modifierName => {\n      if (ListWrapper.contains(parts, modifierName)) {\n        ListWrapper.remove(parts, modifierName);\n        fullKey += modifierName + '.';\n      }\n    });\n    fullKey += key;\n\n    if (parts.length != 0 || key.length === 0) {\n      // returning null instead of throwing to let another plugin process the event\n      return null;\n    }\n    var /** @type {?} */ result = StringMapWrapper.create();\n    StringMapWrapper.set(result, 'domEventName', domEventName);\n    StringMapWrapper.set(result, 'fullKey', fullKey);\n    return result;\n  }\n/**\n * @param {?} event\n * @return {?}\n */\nstatic getEventFullKey(event: KeyboardEvent): string {\n    var /** @type {?} */ fullKey = '';\n    var /** @type {?} */ key = getDOM().getEventKey(event);\n    key = key.toLowerCase();\n    if (StringWrapper.equals(key, ' ')) {\n      key = 'space';  // for readability\n    } else if (StringWrapper.equals(key, '.')) {\n      key = 'dot';  // because '.' is used as a separator in event names\n    }\n    modifierKeys.forEach(modifierName => {\n      if (modifierName != key) {\n        var /** @type {?} */ modifierGetter = StringMapWrapper.get(modifierKeyGetters, modifierName);\n        if (modifierGetter(event)) {\n          fullKey += modifierName + '.';\n        }\n      }\n    });\n    fullKey += key;\n    return fullKey;\n  }\n/**\n * @param {?} element\n * @param {?} fullKey\n * @param {?} handler\n * @param {?} zone\n * @return {?}\n */\nstatic eventCallback(element: HTMLElement, fullKey: any, handler: Function,\n                       zone: NgZone): Function {\n    return (event) => {\n      if (StringWrapper.equals(KeyEventsPlugin.getEventFullKey(event), fullKey)) {\n        zone.runGuarded(() => handler(event));\n      }\n    };\n  }\n/**\n * @internal\n * @param {?} keyName\n * @return {?}\n */\nstatic _normalizeKey(keyName: string): string {\n    // TODO: switch to a StringMap if the mapping grows too much\n    switch (keyName) {\n      case 'esc':\n        return 'escape';\n      default:\n        return keyName;\n    }\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */ static ctorParameters: {type: Function, decorators?: DecoratorInvocation[]}[] = [\n];\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}