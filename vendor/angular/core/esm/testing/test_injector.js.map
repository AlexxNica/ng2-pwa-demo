{"version":3,"file":"test_injector.js","sourceRoot":"","sources":["../../../../../modules/@angular/core/testing/test_injector.ts"],"names":[],"mappings":";AAAA,wBAAuE,UAAU,CAAC,CAAA;AAClF,6BAA4B,0BAA0B,CAAC,CAAA;AACvD,6BAA0B,0BAA0B,CAAC,CAAA;AACrD,uBAAyC,oBAAoB,CAAC,CAAA;AAE9D,wBAAoB,SAAS,CAAC,CAAA;AAC9B,uCAAiC,wBAAwB,CAAC,CAAA;AAE1D,sBAAoB,SAAS,CAAC;AAAtB,8BAAsB;AAE9B;IAAA;QACQ,kBAAa,GAAY,KAAK,CAAC;QAC/B,cAAS,GAAuB,IAAI,CAAC;QACrC,eAAU,GAAmC,EAAE,CAAC;QAUtD,sBAAiB,GAAmC,EAAE,CAAC;QAEvD,yBAAoB,GAAmC,EAAE,CAAC;IAyD5D,CAAC;IApED;;OAEG;IACH,KAAK;QACD,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;QACrB,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;IAC7B,CAAC;IAKH;;;OAGG;IACH,YAAY,CAAC,SAAyC;QAClD,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;YACvB,MAAM,IAAI,0BAAa,CAAC,0DAA0D,CAAC,CAAC;QACtF,CAAC;QACD,IAAI,CAAC,UAAU,GAAG,wBAAW,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC;IACnE,CAAC;IACH;;OAEG;IACH,cAAc;QACV,IAAI,gBAAgB,CAAC,YAAY,GAAG,0BAAkB,CAAC,gBAAgB,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAChG,IAAI,CAAC,SAAS,GAAG,YAAY,CAAC,qBAAqB,CAC/C,wBAAW,CAAC,MAAM,CAAC,IAAI,CAAC,oBAAoB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;QACpE,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC;IACxB,CAAC;IACH;;;OAGG;IACH,GAAG,CAAC,KAAU;QACV,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;YACxB,IAAI,CAAC,cAAc,EAAE,CAAC;QACxB,CAAC;QACD,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IACnC,CAAC;IACH;;;;OAIG;IACH,OAAO,CAAC,MAAa,EAAE,EAAY;QAC/B,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;YACxB,IAAI,CAAC,cAAc,EAAE,CAAC;QACxB,CAAC;QACD,IAAI,gBAAgB,CAAC,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QACrE,MAAM,CAAC,sBAAe,CAAC,KAAK,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;IAC3C,CAAC;IAED,OAAO,8BAA8B;QACtC,gBAAgB;QACjB,YAAY,CAAC,SAAS,CAAC,aAAa,CAAC;QACpC,gBAAgB;QACjB,YAAY,CAAC,SAAS,CAAC,SAAS,CAAC;QAChC,gBAAgB;QACjB,YAAY,CAAC,SAAS,CAAC,UAAU,CAAC;QACjC,gBAAgB;QACjB,YAAY,CAAC,SAAS,CAAC,iBAAiB,CAAC;QACxC,gBAAgB;QACjB,YAAY,CAAC,SAAS,CAAC,oBAAoB,CAAC;IAC1C,CAAC;AAEH,CAAC;AAxEY,oBAAY,eAwExB,CAAA;AAED,IAAI,gBAAgB,CAAC,aAAa,GAAiB,IAAI,CAAC;AACxD;;GAEG;AACH;IACE,EAAE,CAAC,CAAC,aAAa,IAAI,IAAI,CAAC,CAAC,CAAC;QAC1B,aAAa,GAAG,IAAI,YAAY,EAAE,CAAC;IACrC,CAAC;IACD,MAAM,CAAC,aAAa,CAAC;AACvB,CAAC;AALe,uBAAe,kBAK9B,CAAA;AACD;;;;;GAKG;AACH,8BAAqC,iBAAiD,EACjD,oBAAoD;IACvF,IAAI,gBAAgB,CAAC,YAAY,GAAG,eAAe,EAAE,CAAC;IACtD,EAAE,CAAC,CAAC,YAAY,CAAC,iBAAiB,CAAC,MAAM,GAAG,CAAC,IAAI,YAAY,CAAC,oBAAoB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;QAC9F,MAAM,IAAI,0BAAa,CAAC,8DAA8D,CAAC,CAAC;IAC1F,CAAC;IACD,YAAY,CAAC,iBAAiB,GAAG,iBAAiB,CAAC;IACnD,YAAY,CAAC,oBAAoB,GAAG,oBAAoB,CAAC;IACzD,IAAI,gBAAgB,CAAC,QAAQ,GAAG,YAAY,CAAC,cAAc,EAAE,CAAC;IAC9D,IAAI,gBAAgB,CAAC,KAAK,GAAe,QAAQ,CAAC,GAAG,CAAC,4BAAoB,EAAE,IAAI,CAAC,CAAC;IAClF,EAAE,CAAC,CAAC,gBAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QACrB,KAAK,CAAC,OAAO,CAAC,IAAI,IAAI,IAAI,EAAE,CAAC,CAAC;IAChC,CAAC;IACD,YAAY,CAAC,KAAK,EAAE,CAAC;AACvB,CAAC;AAde,4BAAoB,uBAcnC,CAAA;AACD;;;GAGG;AACH;IACE,IAAI,gBAAgB,CAAC,YAAY,GAAG,eAAe,EAAE,CAAC;IACtD,YAAY,CAAC,iBAAiB,GAAG,EAAE,CAAC;IACpC,YAAY,CAAC,oBAAoB,GAAG,EAAE,CAAC;IACvC,YAAY,CAAC,KAAK,EAAE,CAAC;AACvB,CAAC;AALe,8BAAsB,yBAKrC,CAAA;AACD;;;;;GAKG;AACH,gBAAuB,MAAa,EAAE,EAAY;IAChD,IAAI,gBAAgB,CAAC,YAAY,GAAG,eAAe,EAAE,CAAC;IACtD,EAAE,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,yCAAkB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAC5C,yFAAyF;QACzF,mBAAmB;QACnB,MAAM,CAAC;YACL,IAAI,gBAAgB,CAAC,SAAS,GAAuB,YAAY,CAAC,GAAG,CAAC,yCAAkB,CAAC,CAAC;YAC1F,YAAY,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;YACjC,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC;QAC3B,CAAC,CAAA;IACH,CAAC;IAAC,IAAI,CAAC,CAAC;QACN,6DAA6D;QAC7D,MAAM,CAAC,QAAQ,MAAM,CAAC,eAAe,EAAE,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;IACjE,CAAC;AACH,CAAC;AAde,cAAM,SAcrB,CAAA;AAED;IACA;;OAEG;IACH,YAAoB,UAAqB;QAArB,eAAU,GAAV,UAAU,CAAW;IAAG,CAAC;IAC7C;;OAEG;IACK,aAAa;QACjB,IAAI,gBAAgB,CAAC,mBAAmB,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAC7D,EAAE,CAAC,CAAC,mBAAmB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;YACnC,eAAe,EAAE,CAAC,YAAY,CAAC,mBAAmB,CAAC,CAAC;QACtD,CAAC;IACH,CAAC;IACH;;;;OAIG;IACH,MAAM,CAAC,MAAa,EAAE,EAAY;QAC9B,MAAM,CAAC;YACL,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,MAAM,CAAC,WAAW,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC;QACnC,CAAC,CAAA;IACH,CAAC;IACH;;;;;OAKG;IACH,WAAW,CAAC,MAAa,EAAE,EAAY;QACnC,MAAM,CAAC;YACL,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,MAAM,CAAC,gBAAgB,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC;QACxC,CAAC,CAAA;IACH,CAAC;IAED,OAAO,8BAA8B;QACtC,gBAAgB;QACjB,kBAAkB,CAAC,SAAS,CAAC,UAAU,CAAC;IACtC,CAAC;AAEH,CAAC;AA3CY,0BAAkB,qBA2C9B,CAAA;AACD;;;GAGG;AACH,uBAA8B,SAAoB;IAChD,MAAM,CAAC,IAAI,kBAAkB,CAAC,SAAS,CAAC,CAAC;AAC3C,CAAC;AAFe,qBAAa,gBAE5B,CAAA;AACD;;;;;GAKG;AACH,qBAA4B,MAAa,EAAE,EAAY;IACrD,MAAM,CAAC,aAAK,CAAC,MAAM,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC;AACnC,CAAC;AAFe,mBAAW,cAE1B,CAAA;AAED,gFAAgF;AAChF,2BAA2B;AAC3B,IAAI,gBAAgB,CAAC,WAAW,GAAG,MAAM,CAAC;AAC1C,IAAI,gBAAgB,CAAC,gBAAgB,GAAG,WAAW,CAAC","sourcesContent":["import {ReflectiveInjector, Provider, PLATFORM_INITIALIZER, Type} from '../index';\nimport {BaseException} from '../src/facade/exceptions';\nimport {ListWrapper} from '../src/facade/collection';\nimport {FunctionWrapper, isPresent} from '../src/facade/lang';\n\nimport {async} from './async';\nimport {AsyncTestCompleter} from './async_test_completer';\n\nexport {async} from './async';\n\nexport class TestInjector {\nprivate _instantiated: boolean = false;\nprivate _injector: ReflectiveInjector = null;\nprivate _providers: Array<Type | Provider | any[]> = [];\n/**\n * @return {?}\n */\nreset() {\n    this._injector = null;\n    this._providers = [];\n    this._instantiated = false;\n  }\n\n  platformProviders: Array<Type | Provider | any[]> = [];\n\n  applicationProviders: Array<Type | Provider | any[]> = [];\n/**\n * @param {?} providers\n * @return {?}\n */\naddProviders(providers: Array<Type | Provider | any[]>) {\n    if (this._instantiated) {\n      throw new BaseException('Cannot add providers after test injector is instantiated');\n    }\n    this._providers = ListWrapper.concat(this._providers, providers);\n  }\n/**\n * @return {?}\n */\ncreateInjector() {\n    var /** @type {?} */ rootInjector = ReflectiveInjector.resolveAndCreate(this.platformProviders);\n    this._injector = rootInjector.resolveAndCreateChild(\n        ListWrapper.concat(this.applicationProviders, this._providers));\n    this._instantiated = true;\n    return this._injector;\n  }\n/**\n * @param {?} token\n * @return {?}\n */\nget(token: any) {\n    if (!this._instantiated) {\n      this.createInjector();\n    }\n    return this._injector.get(token);\n  }\n/**\n * @param {?} tokens\n * @param {?} fn\n * @return {?}\n */\nexecute(tokens: any[], fn: Function): any {\n    if (!this._instantiated) {\n      this.createInjector();\n    }\n    var /** @type {?} */ params = tokens.map(t => this._injector.get(t));\n    return FunctionWrapper.apply(fn, params);\n  }\n\n  static _tsickle_typeAnnotationsHelper() {\n /** @type {?} */\nTestInjector.prototype._instantiated;\n /** @type {?} */\nTestInjector.prototype._injector;\n /** @type {?} */\nTestInjector.prototype._providers;\n /** @type {?} */\nTestInjector.prototype.platformProviders;\n /** @type {?} */\nTestInjector.prototype.applicationProviders;\n  }\n\n}\n\nvar /** @type {?} */ _testInjector: TestInjector = null;\n/**\n * @return {?}\n */\nexport function getTestInjector() {\n  if (_testInjector == null) {\n    _testInjector = new TestInjector();\n  }\n  return _testInjector;\n}\n/**\n *  Set the providers that the test injector should use. These should be providers common to every test in the suite. * This may only be called once, to set up the common providers for the current test suite on teh current platform. If you absolutely need to change the providers, first use `resetBaseTestProviders`. * Test Providers for individual platforms are available from 'angular2/platform/testing/<platform_name>'.\n * @param {?} platformProviders\n * @param {?} applicationProviders\n * @return {?}\n */\nexport function setBaseTestProviders(platformProviders: Array<Type | Provider | any[]>,\n                                     applicationProviders: Array<Type | Provider | any[]>) {\n  var /** @type {?} */ testInjector = getTestInjector();\n  if (testInjector.platformProviders.length > 0 || testInjector.applicationProviders.length > 0) {\n    throw new BaseException('Cannot set base providers because it has already been called');\n  }\n  testInjector.platformProviders = platformProviders;\n  testInjector.applicationProviders = applicationProviders;\n  var /** @type {?} */ injector = testInjector.createInjector();\n  let /** @type {?} */ inits: Function[] = injector.get(PLATFORM_INITIALIZER, null);\n  if (isPresent(inits)) {\n    inits.forEach(init => init());\n  }\n  testInjector.reset();\n}\n/**\n *  Reset the providers for the test injector.\n * @return {?}\n */\nexport function resetBaseTestProviders() {\n  var /** @type {?} */ testInjector = getTestInjector();\n  testInjector.platformProviders = [];\n  testInjector.applicationProviders = [];\n  testInjector.reset();\n}\n/**\n *  Allows injecting dependencies in `beforeEach()` and `it()`. * Example: * ``` beforeEach(inject([Dependency, AClass], (dep, object) => { // some code that uses `dep` and `object` // ... })); * it('...', inject([AClass], (object) => { object.doSomething(); expect(...); }) ``` * Notes: - inject is currently a function because of some Traceur limitation the syntax should eventually becomes `it('...', @Inject (object: AClass, async: AsyncTestCompleter) => { ... });` *\n * @param {?} tokens\n * @param {?} fn\n * @return {?}\n */\nexport function inject(tokens: any[], fn: Function): Function {\n  let /** @type {?} */ testInjector = getTestInjector();\n  if (tokens.indexOf(AsyncTestCompleter) >= 0) {\n    // Return an async test method that returns a Promise if AsyncTestCompleter is one of the\n    // injected tokens.\n    return () => {\n      let /** @type {?} */ completer: AsyncTestCompleter = testInjector.get(AsyncTestCompleter);\n      testInjector.execute(tokens, fn);\n      return completer.promise;\n    }\n  } else {\n    // Return a synchronous test method with the injected tokens.\n    return () => { return getTestInjector().execute(tokens, fn); };\n  }\n}\n\nexport class InjectSetupWrapper {\n/**\n * @param {?} _providers\n */\nconstructor(private _providers: () => any) {}\n/**\n * @return {?}\n */\nprivate _addProviders() {\n    var /** @type {?} */ additionalProviders = this._providers();\n    if (additionalProviders.length > 0) {\n      getTestInjector().addProviders(additionalProviders);\n    }\n  }\n/**\n * @param {?} tokens\n * @param {?} fn\n * @return {?}\n */\ninject(tokens: any[], fn: Function): Function {\n    return () => {\n      this._addProviders();\n      return inject_impl(tokens, fn)();\n    }\n  }\n/**\n * @Deprecated {use async(withProviders().inject())}\n * @param {?} tokens\n * @param {?} fn\n * @return {?}\n */\ninjectAsync(tokens: any[], fn: Function): Function {\n    return () => {\n      this._addProviders();\n      return injectAsync_impl(tokens, fn)();\n    }\n  }\n\n  static _tsickle_typeAnnotationsHelper() {\n /** @type {?} */\nInjectSetupWrapper.prototype._providers;\n  }\n\n}\n/**\n * @param {?} providers\n * @return {?}\n */\nexport function withProviders(providers: () => any) {\n  return new InjectSetupWrapper(providers);\n}\n/**\n * @Deprecated {use async(inject())} * Allows injecting dependencies in `beforeEach()` and `it()`. The test must return a promise which will resolve when all asynchronous activity is complete. * Example: * ``` it('...', injectAsync([AClass], (object) => { return object.doSomething().then(() => { expect(...); }); }) ``` *\n * @param {?} tokens\n * @param {?} fn\n * @return {?}\n */\nexport function injectAsync(tokens: any[], fn: Function): Function {\n  return async(inject(tokens, fn));\n}\n\n// This is to ensure inject(Async) within InjectSetupWrapper doesn't call itself\n// when transpiled to Dart.\nvar /** @type {?} */ inject_impl = inject;\nvar /** @type {?} */ injectAsync_impl = injectAsync;\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}